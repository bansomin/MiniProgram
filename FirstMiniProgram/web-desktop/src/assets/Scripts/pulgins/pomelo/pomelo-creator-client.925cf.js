!function(){function e(e){if(e)return t(e)}function t(t){for(var n in e.prototype)t[n]=e.prototype[n];return t}e.prototype.on=e.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(t),this},e.prototype.once=function(e,t){function n(){o.off(e,n),t.apply(this,arguments)}var o=this;return this._callbacks=this._callbacks||{},n.fn=t,this.on(e,n),this},e.prototype.off=e.prototype.removeListener=e.prototype.removeAllListeners=e.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks[e];if(!n)return this;if(1==arguments.length)return delete this._callbacks[e],this;for(var o,r=0;r<n.length;r++)if((o=n[r])===t||o.fn===t){n.splice(r,1);break}return this},e.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks[e];if(n)for(var o=0,r=(n=n.slice(0)).length;o<r;++o)n[o].apply(this,t);return this},e.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]},e.prototype.hasListeners=function(e){return!!this.listeners(e).length},"undefined"!=typeof window&&(window.EventEmitter=e)}(),function(e,t,n){var o=typeof window=="undefined"?module.exports:{},r=o.Package={},i=o.Message={};r.TYPE_HANDSHAKE=1,r.TYPE_HANDSHAKE_ACK=2,r.TYPE_HEARTBEAT=3,r.TYPE_DATA=4,r.TYPE_KICK=5,i.TYPE_REQUEST=0,i.TYPE_NOTIFY=1,i.TYPE_RESPONSE=2,i.TYPE_PUSH=3,o.strencode=function(e){for(var n=new t(3*e.length),o=0,r=0;r<e.length;r++){var i=e.charCodeAt(r),a=null;a=i<=127?[i]:i<=2047?[192|i>>6,128|63&i]:[224|i>>12,128|(4032&i)>>6,128|63&i];for(var s=0;s<a.length;s++)n[o]=a[s],++o}var u=new t(o);return c(u,0,n,0,o),u},o.strdecode=function(e){for(var n=new t(e),o=[],r=0,i=0,c=n.length;r<c;)n[r]<128?(i=n[r],r+=1):n[r]<224?(i=((63&n[r])<<6)+(63&n[r+1]),r+=2):(i=((15&n[r])<<12)+((63&n[r+1])<<6)+(63&n[r+2]),r+=3),o.push(i);return String.fromCharCode.apply(null,o)},r.encode=function(e,n){var o=n?n.length:0,r=new t(4+o),i=0;return r[i++]=255&e,r[i++]=o>>16&255,r[i++]=o>>8&255,r[i++]=255&o,n&&c(r,i,n,0,o),r},r.decode=function(e){for(var n=0,o=new t(e),r=0,i=[];n<o.length;){var a=o[n++],s=(r=(o[n++]<<16|o[n++]<<8|o[n++])>>>0)?new t(r):null;c(s,0,o,n,r),n+=r,i.push({type:a,body:s})}return 1===i.length?i[0]:i},i.encode=function(e,n,r,i,c){var h=1+(a(n)?u(e):0);if(s(n))if(r){if("number"!=typeof i)throw new Error("error flag for number route!");h+=2}else if(h+=1,i){if((i=o.strencode(i)).length>255)throw new Error("route maxlength is overflow");h+=i.length}c&&(h+=c.length);var v=new t(h),y=0;return y=l(n,r,v,y),a(n)&&(y=f(e,v,y)),s(n)&&(y=d(r,i,v,y)),c&&(y=p(c,v,y)),v},i.decode=function(e){var n=new t(e),r=n.length||n.byteLength,i=0,u=0,l=null,f=n[i++],d=1&f,p=f>>1&7;if(a(p)){var h=parseInt(n[i]),v=0;do{u+=(127&(h=parseInt(n[i])))*Math.pow(2,7*v),i++,v++}while(h>=128)}if(s(p))if(d)l=n[i++]<<8|n[i++];else{var y=n[i++];y?(l=new t(y),c(l,0,n,i,y),l=o.strdecode(l)):l="",i+=y}var g=r-i,w=new t(g);return c(w,0,n,i,g),{id:u,type:p,compressRoute:d,route:l,body:w}};var c=function(e,t,n,o,r){if("function"==typeof n.copy)n.copy(e,t,o,o+r);else for(var i=0;i<r;i++)e[t++]=n[o++]},a=function(e){return e===i.TYPE_REQUEST||e===i.TYPE_RESPONSE},s=function(e){return e===i.TYPE_REQUEST||e===i.TYPE_NOTIFY||e===i.TYPE_PUSH},u=function(e){var t=0;do{t+=1,e>>=7}while(e>0);return t},l=function(e,t,n,o){if(e!==i.TYPE_REQUEST&&e!==i.TYPE_NOTIFY&&e!==i.TYPE_RESPONSE&&e!==i.TYPE_PUSH)throw new Error("unkonw message type: "+e);return n[o]=e<<1|(t?1:0),o+1},f=function(e,t,n){do{var o=e%128,r=Math.floor(e/128);0!==r&&(o+=128),t[n++]=o,e=r}while(0!==e);return n},d=function(e,t,n,o){if(e){if(t>65535)throw new Error("route number is overflow");n[o++]=t>>8&255,n[o++]=255&t}else t?(n[o++]=255&t.length,c(n,o,t,0,t.length),o+=t.length):n[o++]=0;return o},p=function(e,t,n){return c(t,n,e,0,e.length),n+e.length};"undefined"!=typeof window&&(window.Protocol=o)}(0,"undefined"==typeof window?Buffer:Uint8Array),function(e,t){var n=typeof window=="undefined"?module.exports:{};n.init=function(e){n.encoder.init(e.encoderProtos),n.decoder.init(e.decoderProtos)},n.encode=function(e,t){return n.encoder.encode(e,t)},n.decode=function(e,t){return n.decoder.decode(e,t)},"undefined"!=typeof window&&(window.protobuf=n)}(),(("undefined"!==typeof protobuf?protobuf:module.exports).constants={}).TYPES={uInt32:0,sInt32:0,int32:0,double:1,string:2,message:2,float:5},(("undefined"!==typeof protobuf?protobuf:module.exports).util={}).isSimpleType=function(e){return"uInt32"===e||"sInt32"===e||"int32"===e||"uInt64"===e||"sInt64"===e||"float"===e||"double"===e},function(e,t){function n(e){return e<=127?[e]:e<=2047?[192|e>>6,128|63&e]:[224|e>>12,128|(4032&e)>>6,128|63&e]}function o(e){return e<=127?1:e<=2047?2:3}var r=("undefined"!==typeof protobuf?protobuf:module.exports).codec={},i=new ArrayBuffer(8),c=new Float32Array(i),a=new Float64Array(i),s=new Uint8Array(i);r.encodeUInt32=function(e){var e=parseInt(e);if(isNaN(e)||e<0)return null;var t=[];do{var n=e%128,o=Math.floor(e/128);0!==o&&(n+=128),t.push(n),e=o}while(0!==e);return t},r.encodeSInt32=function(e){var e=parseInt(e);return isNaN(e)?null:(e=e<0?2*Math.abs(e)-1:2*e,r.encodeUInt32(e))},r.decodeUInt32=function(e){for(var t=0,n=0;n<e.length;n++){var o=parseInt(e[n]);if(t+=(127&o)*Math.pow(2,7*n),o<128)return t}return t},r.decodeSInt32=function(e){var t=this.decodeUInt32(e);return t=(t%2+t)/2*(t%2==1?-1:1)},r.encodeFloat=function(e){return c[0]=e,s},r.decodeFloat=function(e,t){if(!e||e.length<t+4)return null;for(var n=0;n<4;n++)s[n]=e[t+n];return c[0]},r.encodeDouble=function(e){return a[0]=e,s.subarray(0,8)},r.decodeDouble=function(e,t){if(!e||e.length<t+8)return null;for(var n=0;n<8;n++)s[n]=e[t+n];return a[0]},r.encodeStr=function(e,t,o){for(var r=0;r<o.length;r++)for(var i=n(o.charCodeAt(r)),c=0;c<i.length;c++)e[t]=i[c],t++;return t},r.decodeStr=function(e,t,n){for(var o=[],r=t+n;t<r;){var i=0;e[t]<128?(i=e[t],t+=1):e[t]<224?(i=((63&e[t])<<6)+(63&e[t+1]),t+=2):(i=((15&e[t])<<12)+((63&e[t+1])<<6)+(63&e[t+2]),t+=3),o.push(i)}for(var c="",a=0;a<o.length;)c+=String.fromCharCode.apply(null,o.slice(a,a+1e4)),a+=1e4;return c},r.byteLength=function(e){if("string"!=typeof e)return-1;for(var t=0,n=0;n<e.length;n++)t+=o(e.charCodeAt(n));return t}}(),function(e,t){function n(e,t){if(!t)return!1;for(var o in t){var r=t[o];switch(r.option){case"required":if(void 0===e[o])return console.warn("no property exist for required! name: %j, proto: %j, msg: %j",o,r,e),!1;case"optional":if(void 0!==e[o]&&(i=t.__messages[r.type]||u.protos["message "+r.type])&&!n(e[o],i))return console.warn("inner proto error! name: %j, proto: %j, msg: %j",o,r,e),!1;break;case"repeated":var i=t.__messages[r.type]||u.protos["message "+r.type];if(e[o]&&i)for(var c=0;c<e[o].length;c++)if(!n(e[o][c],i))return!1}}return!0}function o(e,t,n,o){for(var s in o)if(n[s]){var u=n[s];switch(u.option){case"required":case"optional":t=c(e,t,a(u.type,u.tag)),t=r(o[s],u.type,t,e,n);break;case"repeated":o[s].length>0&&(t=i(o[s],u,t,e,n))}}return t}function r(e,t,n,r,i){switch(t){case"uInt32":n=c(r,n,l.encodeUInt32(e));break;case"int32":case"sInt32":n=c(r,n,l.encodeSInt32(e));break;case"float":c(r,n,l.encodeFloat(e)),n+=4;break;case"double":c(r,n,l.encodeDouble(e)),n+=8;break;case"string":var a=l.byteLength(e);n=c(r,n,l.encodeUInt32(a)),l.encodeStr(r,n,e),n+=a;break;default:var s=i.__messages[t]||u.protos["message "+t];if(s){var f=new ArrayBuffer(2*l.byteLength(JSON.stringify(e)));a=o(f,a=0,s,e),n=c(r,n,l.encodeUInt32(a));for(var d=0;d<a;d++)r[n]=f[d],n++}}return n}function i(e,t,n,o,i){var s=0;if(d.isSimpleType(t.type))for(n=c(o,n=c(o,n,a(t.type,t.tag)),l.encodeUInt32(e.length)),s=0;s<e.length;s++)n=r(e[s],t.type,n,o);else for(s=0;s<e.length;s++)n=c(o,n,a(t.type,t.tag)),n=r(e[s],t.type,n,o,i);return n}function c(e,t,n){for(var o=0;o<n.length;o++,t++)e[t]=n[o];return t}function a(e,t){var n=f.TYPES[e]||2;return l.encodeUInt32(t<<3|n)}var s=e,u=e.encoder={},l=s.codec,f=s.constants,d=s.util;u.init=function(e){this.protos=e||{}},u.encode=function(e,t){var r=this.protos[e];if(!n(t,r))return null;var i=l.byteLength(JSON.stringify(t)),c=new ArrayBuffer(i),a=new Uint8Array(c),s=0;return r&&(s=o(a,s,r,t))>0?a.subarray(0,s):null}}("undefined"!=typeof protobuf?protobuf:module.exports),function(e,t){function n(e,t,n){for(;d<n;){var c=o(),a=(c.type,c.tag),s=t.__tags[a];switch(t[s].option){case"optional":case"required":e[s]=r(t[s].type,t);break;case"repeated":e[s]||(e[s]=[]),i(e[s],t[s].type,t)}}return e}function o(){var e=l.decodeUInt32(c());return{type:7&e,tag:e>>3}}function r(e,t){switch(e){case"uInt32":return l.decodeUInt32(c());case"int32":case"sInt32":return l.decodeSInt32(c());case"float":var o=l.decodeFloat(a,d);return d+=4,o;case"double":var r=l.decodeDouble(a,d);return d+=8,r;case"string":var i=l.decodeUInt32(c()),s=l.decodeStr(a,d,i);return d+=i,s;default:var f=t&&(t.__messages[e]||u.protos["message "+e]);if(f){var i=l.decodeUInt32(c()),p={};return n(p,f,d+i),p}}}function i(e,t,n){if(f.isSimpleType(t))for(var o=l.decodeUInt32(c()),i=0;i<o;i++)e.push(r(t));else e.push(r(t,n))}function c(e){var t=[],n=d;e=e||!1;var o;do{o=a[n],t.push(o),n++}while(o>=128);return e||(d=n),t}var a,s=e,u=e.decoder={},l=s.codec,f=s.util,d=0;u.init=function(e){this.protos=e||{}},u.setProtos=function(e){e&&(this.protos=e)},u.decode=function(e,t){var o=this.protos[e];return a=t,d=0,o?n({},o,a.length):null}}("undefined"!=typeof protobuf?protobuf:module.exports),function(){var e=window.Protocol,t=window.protobuf,n=window.decodeIO_protobuf,o=null,r=null,i=e.Package,c=e.Message,a=window.EventEmitter,s=window.rsa,u=null;"undefined"!=typeof window&&"undefined"!=typeof sys&&sys.localStorage&&(window.localStorage=sys.localStorage);"function"!=typeof Object.create&&(Object.create=function(e){function t(){}return t.prototype=e,new t});var l=window,f=Object.create(a.prototype);l.pomelo=f;var d,p=null,h=0,v={},y={},g={},w={},b={},E={},m={},_=0,T=0,S=0,P=0,I=null,k=null,A=null,Y=null,N=null,U=!1,O=null,H=null,D=0,J=5e3,R={sys:{type:"js-websocket",version:"0.0.1",rsa:{}},user:{}},C=null;f.init=function(e,t){C=t;var n=e.host,o=e.port;N=e.encode||j,Y=e.decode||K;var r="ws://"+n;if(o&&(r+=":"+o),R.user=e.user,e.encrypt){d=!0,s.generate(1024,"10001");var i={rsa_n:s.n.toString(16),rsa_e:s.e};R.sys.rsa=i}A=e.handshakeCallback,x(e,r,t)};var K=f.decode=function(e){var t=c.decode(e);if(!(t.id>0)||(t.route=g[t.id],delete g[t.id],t.route))return t.body=V(t),t},j=f.encode=function(n,r,i){var a=n?c.TYPE_REQUEST:c.TYPE_NOTIFY;i=t&&m[r]?t.encode(r,i):o&&o.lookup(r)?new(o.build(r))(i).encodeNB():e.strencode(JSON.stringify(i));var s=0;return w&&w[r]&&(r=w[r],s=1),c.encode(n,a,s,r,i)},x=function(c,a,s){console.log("connect to "+a);var l=(c=c||{}).maxReconnectAttempts||10;if(H=a,window.localStorage&&window.localStorage.getItem("protos")&&0===_){var d=JSON.parse(window.localStorage.getItem("protos"));_=d.version||0,E=d.server||{},m=d.client||{},t&&t.init({encoderProtos:m,decoderProtos:E}),n&&(o=n.loadJson(m),r=n.loadJson(E))}R.sys.protoVersion=_;(p=new WebSocket(a)).binaryType="arraybuffer",p.onopen=function(t){U&&f.emit("reconnect"),F();var n=i.encode(i.TYPE_HANDSHAKE,e.strencode(JSON.stringify(R)));B(n)},p.onmessage=function(e){q(i.decode(e.data),s),S&&(P=Date.now()+S)},p.onerror=function(e){f.emit("io-error",e),console.error("socket error: ",e)},p.onclose=function(e){f.emit("close",e),f.emit("disconnect",e),console.error("socket close: ",e),c.reconnect&&D<l&&(U=!0,D++,O=setTimeout(function(){x(c,H,s)},J),J*=2),p=null,u&&u(),u=null}};f.disconnect=function(e){u=e,p&&(p.disconnect&&p.disconnect(),p.close&&p.close(),console.log("disconnect"),p=null),I&&(clearTimeout(I),I=null),k&&(clearTimeout(k),k=null)};var F=function(){U=!1,J=5e3,D=0,clearTimeout(O)};f.request=function(e,t,n){2===arguments.length&&"function"==typeof t?(n=t,t={}):t=t||{},(e=e||t.route)&&(L(++h,e,t),v[h]=n,g[h]=e)},f.notify=function(e,t){L(0,e,t=t||{})};var L=function(e,t,n){if(d){n=JSON.stringify(n);var o=s.signString(n,"sha256");(n=JSON.parse(n)).__crypto__=o}N&&(n=N(e,t,n));var r=i.encode(i.TYPE_DATA,n);B(r)},B=function(e){null!==p&&p.send(e.buffer)},M=function(){var e=P-Date.now();e>100?k=setTimeout(M,e):(console.error("server heartbeat timeout"),f.emit("heartbeat timeout"),f.disconnect())};y[i.TYPE_HANDSHAKE]=function(t){if(501!==(t=JSON.parse(e.strdecode(t))).code)if(200===t.code){W(t);var n=i.encode(i.TYPE_HANDSHAKE_ACK);B(n),C&&C(p)}else f.emit("error","handshake fail");else f.emit("error","client version not fullfill")},y[i.TYPE_HEARTBEAT]=function(e){if(T){var t=i.encode(i.TYPE_HEARTBEAT);k&&(clearTimeout(k),k=null),I||(I=setTimeout(function(){I=null,B(t),P=Date.now()+S,k=setTimeout(M,S)},T))}},y[i.TYPE_DATA]=function(e){var t=e;Y&&(t=Y(t)),Q(f,t)},y[i.TYPE_KICK]=function(t){t=JSON.parse(e.strdecode(t)),f.emit("onKick",t)};var q=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var n=e[t];y[n.type](n.body)}else y[e.type](e.body)},Q=function(e,t){if(t.id){var n=v[t.id];delete v[t.id],"function"==typeof n&&n(t.body)}else e.emit(t.route,t.body)},V=function(n){var o=n.route;if(n.compressRoute){if(!b[o])return{};o=n.route=b[o]}return t&&E[o]?t.decode(o,n.body):r&&r.lookup(o)?r.build(o).decode(n.body):JSON.parse(e.strdecode(n.body))},W=function(e){e.sys&&e.sys.heartbeat?(T=1e3*e.sys.heartbeat,S=2*T):(T=0,S=0),z(e),"function"==typeof A&&A(e.user)},z=function(e){if(e&&e.sys){w=e.sys.dict;var i=e.sys.protos;if(w){w=w,b={};for(var c in w)b[w[c]]=c}i&&(_=i.version||0,E=i.server||{},m=i.client||{},window.localStorage.setItem("protos",JSON.stringify(i)),t&&t.init({encoderProtos:i.client,decoderProtos:i.server}),n&&(o=n.loadJson(m),r=n.loadJson(E)))}}}();